```{r}
library(tidyverse)
library(tidymodels)
booze <- read.csv(here::here("grouped_data_booze.csv"))
DEAD <- read.csv(here::here("grouped_data_dead.csv"))
```

```{r}
booze <- booze |>
  #separate(date, into = c("year", "month"), sep = "-") |>
  mutate(
    #across(c(year, month), as.factor),
           company = as.factor(company))

booze_large_chains <- booze |>
  filter(num_stores >= 5)

DEAD <- DEAD |>
  mutate(
    county = as.factor(county),
    alcohol_type = as.factor(alcohol_type)
  )
```


```{r}
lin_reg <- linear_reg() |>
  set_mode("regression") |>
  set_engine("lm")

#USE THIS SEED FOR CONSISTENCY
set.seed(40313)
booze_cv <- vfold_cv(booze, v = 10)
booze_large_cv <- vfold_cv(booze, v=10)
DEAD_cv <- vfold_cv(DEAD, v=10)
```


#Booze Models


Predict sum Sale Dollars from date, bottles_sold(<-this is cheating),

Predict sum Sale Dollars from num_transactions(<-cheating), num_stores

Predict sum Sale Dollars from num stores for companys with large amount of stores

```{r}
booze_rec1 <- recipe(sum_sale_dollars ~ num_stores + date,
                        data=booze) |>
    step_mutate(
    year = substr(date, 1, 4),
    month = substr(date, 6, 7)
  ) |>
  step_mutate(
    year = factor(year),
    month = factor(month)
  ) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())

booze_cv1 <- lin_reg |>
  fit_resamples(booze_rec1,
                resamples = booze_cv)

booze_cv1 |> collect_metrics()
```

```{r}
booze_rec2 <- recipe(sum_sale_dollars ~ date + num_stores,
                        data=booze_large_chains) |>
    step_mutate(
    year = substr(date, 1, 4),
    month = substr(date, 6, 7)
  ) |>
  step_mutate(
    year = factor(year),
    month = factor(month)
  ) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())

booze_cv2 <- lin_reg |>
  fit_resamples(booze_rec2,
                resamples = booze_large_cv)

booze_cv2 |> collect_metrics()
```
split year and month?


#DEAD Models

Predict sum Sale Dollars from county, alcohol type

Predict sum Sale Dollars from population and date

Predict sum Sale Dollars from alcohol type

```{r}
DEAD_rec1 <- recipe(sum_sale_dollars ~ county + alcohol_type,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv1 <- lin_reg |>
  fit_resamples(DEAD_rec1,
                resamples = DEAD_cv)

DEAD_cv1 |> collect_metrics()
```

```{r}
DEAD_rec2 <- recipe(sum_sale_dollars ~ population + date,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv2 <- lin_reg |>
  fit_resamples(DEAD_rec2,
                resamples = DEAD_cv)

DEAD_cv2 |> collect_metrics()
```

```{r}
DEAD_rec3 <- recipe(sum_sale_dollars ~ population + alcohol_type,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv3 <- lin_reg |>
  fit_resamples(DEAD_rec3,
                resamples = DEAD_cv)

DEAD_cv3 |> collect_metrics()
```


```{r}
DEAD_rec4 <- recipe(sum_sale_dollars ~ alcohol_type,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv4 <- lin_reg |>
  fit_resamples(DEAD_rec4,
                resamples = DEAD_cv)

DEAD_cv4 |> collect_metrics()
```

```{r}
DEAD_rec5 <- recipe(sum_sale_dollars ~ population + alcohol_type + county,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv5 <- lin_reg |>
  fit_resamples(DEAD_rec3,
                resamples = DEAD_cv)

DEAD_cv5 |> collect_metrics()
```

```{r}

DEAD_rec6 <- recipe(sum_sale_dollars ~ population + alcohol_type + date,
                        data=DEAD) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors())


DEAD_cv6 <- lin_reg |>
  fit_resamples(DEAD_rec6,
                resamples = DEAD_cv)

DEAD_cv6 |> collect_metrics()
```

BEST IS JUST POPULATION AND ALCOHOL TYPE